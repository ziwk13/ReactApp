<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <title>useContext</title>
</head>
<body>

<!--
1. React.createContext()
  1) 컨텍스트(Context) 객체를 생성할 수 있습니다. 
  2) 여기서 컨텍스트란 컴포넌트에서 제공하거나 읽을 수 있는 정보를 의미합니다.
  3) 컴포넌트 트리 전체에 데이터를 전달할 수 있도록 해주는 Context API의 핵심 함수입니다. 
  4) createContext를 사용하면 여러 단계의 컴포넌트에 props를 일일이 전달하지 않고도(props drilling 회피), 원하는 값을 하위 컴포넌트에서 바로 사용할 수 있습니다.
    (props drilling: 최상위 컴포넌트부터 아래 컴포넌트로 props를 계속 전달하는 것을 의미합니다.)
  5) 컨텍스트 객체에는 Provider와 Consumer 컴포넌트가 포함되어 있습니다.
    (1) Provider 컴포넌트는 value prop을 통해 하위 컴포넌트에 값을 제공합니다. 하위 트리의 모든 컴포넌트에서 이 값을 사용할 수 있습니다.
    (2) 하위 컴포넌트에서는 React.useContext(Context) 또는 Context.Consumer를 통해 값을 읽을 수 있습니다. 함수형 컴포넌트에서는 React.useContext(Context) 사용이 더 간편합니다.
  
  
2. React.createContext() 구문
  1) 형식
    const context = React.createContext(defaultValue)
  2) 설명
    (1) context
      - 컨텍스트(Context) 객체입니다.
      - 컨텍스트 객체가 자체적으로 가진 정보는 없으며 다른 컴포넌트가 읽거나 다른 컴포넌트에게 제공할 정보를 나타냅니다.
    (2) defaultValue
      - defaultValue는 상위에 Provider 컴포넌트가 없을 때만 사용되는 기본값입니다.
      - 의미 있는 값이 없는 경우 null 값을 지정합니다.
      - Provider가 명시적으로 undefined를 value로 전달해도 defaultValue가 사용되지는 않습니다.


3. React.useContext()
  1) 컴포넌트에서 컨텍스트(Context)를 구독하여 해당 컨텍스트에 저장된 내용을 확인할 수 있는 훅(Hooks) 입니다.
  2) Context API를 통해 전역 데이터(예: 테마, 사용자 정보 등)를 props 없이 여러 컴포넌트에서 공유할 때 사용합니다.
  3) useContext(SomeContext)를 호출하면, 트리 상에서 가장 가까운 <SomeContext.Provider>의 value를 반환합니다.
  4) Provider가 없으면, createContext에 지정한 defaultValue를 반환합니다. 대신 Provider가 value로 undefined를 명시적으로 전달하면 defaultValue는 반환되지 않고, undefined가 반환됩니다.
  5) 값이 바뀌면, 해당 Context를 구독하는 컴포넌트가 자동으로 리렌더링됩니다.


4. React.useContext() 구문
  1) 형식
    const value = React.useContext(SomeContext)
  2) 설명
    (1) value
      - 이 값은 컴포넌트 트리 중 가장 가까운 위쪽 컴포넌트에서 호출한 <SomeContext.Provider>에 전달한 value로 결정합니다.
      - <SomeContext.Provider>는 useContext()를 호출하는 컴포넌트의 부모 컴포넌트에 배치해야 합니다.
    (2) SomeContext
      - React.createContext()를 이용해 생성한 컨텍스트입니다.
-->

<div id="root1"></div>
<script type="text/babel">
  // props drilling (좋지 않는 코드 구성)
  function App1() {
    const user = {
      name: 'jessica',
      age: 30,
    }
    return (
      <Middle1 user={user}/>
    )
  }

  function Middle1( {user} ) {
    return (
      <UserProfile1 user={user}/>
    )
  }

  function UserProfile1( {user} ) {
    return (
      <>
        <h1>{user.name}</h1>
        <h1>{user.age}</h1>
      </>
    )
  }

  ReactDOM.createRoot(document.getElementById('root1')).render(<App1/>)
</script>

<hr>

<div id="root2"></div>
<script type="text/babel">

  // Context 생성 (생성 및 초기화)
  const UserContext = React.createContext({
    name: 'default',
    age: 0,
  });

  // 최상위 컴포넌트에서 Context의 Provider를 이용해 값을 제공 한다.
  function App2() {
    const user = {
      name: 'james',
      age: 40,
    }
    return (
      <UserContext.Provider value={user}>
        <Middle2 />
      </UserContext.Provider>
    )
  }

  function Middle2() {
    return (
      <>
        <h1>Middle 컴포넌트</h1>
        <UserProfile2 />
      </>
    )
  }
  // 하위 컴포넌트는 useContext()를 이용해 Context 사용(구독)
  function UserProfile2() {
    // UserContext의 Provider가 제공한 값을 사용하는 Consumer 설정
    const user = React.useContext(UserContext);
    return (
      <div style={{ marginLeft: '20px', }}>
        <h3>UserProfile 컴포넌트</h3>
        <div>{user.name}</div>
        <div>{user.age}</div>
      </div>
    )
  }
  ReactDOM.createRoot(document.getElementById('root2')).render(<App2/>)
</script>

<div id="root3"></div>
<script type="text/babel">

  // reducer 함수 (formReducer)
  const formReducer = (contact, action) => {
    // action에 따른 새로운 state(contact 객체) 반환
    return {
      ...contact,  // 기존 contact 객체의 값을 그대로 사용합니다.
      [action.name]: action.value,  // action으로 전달된 e.target 객체의 값을 이용해 email 또는 mobile을 수정합니다.
    }
  }

  // Context 생성
  const FormContext = React.createContext();

  // <InputField> 컴포넌트
  const InputField = ({ type, name, placeholder }) => {  // 객체 구조 분해 할당
    // FormContext에 저장된 contact과 saveContact을 사용합니다.
    const { contact, saveContact } = React.useContext(FormContext);
    // event handler
    const onChangeHandler = (e) => {
      saveContact(e.target);
    }
    return (
      <input 
        type={type} 
        name={name} 
        placeholder={placeholder} 
        value={contact[name]} 
        onChange={onChangeHandler} />
    )
  }

  // <Form> 컴포넌트
  const Form = () => {
    // FormContext에 저장된 contact을 사용합니다.
    const { contact } = React.useContext(FormContext);
    return (
      <>
        <InputField 
          type="text"
          name="email"
          placeholder="id@example.com" />
        <br/>
        <InputField 
          type="text"
          name="mobile"
          placeholder="010-0000-0000" />
        <br/>
        <h1>{contact.email}</h1>
        <h1>{contact.mobile}</h1>
      </>
    )

  }

  // <FormContext.Provider>를 반환하는 <FormProvider> 컴포넌트
  function FormProvider({ children }) {  // 하위 컴포넌트 <Form/>을 children으로 받습니다.
    const initialContact = {
      email: '',
      mobile: '',
    }
    const [ contact, saveContact ] = React.useReducer(formReducer, initialContact);
    return (
      <FormContext.Provider value={ {contact, saveContact} }>
        {children}
      </FormContext.Provider>
    )
  }

  // 최상위 컴포넌트
  function App() {
    return (
      <FormProvider>
        <Form />
      </FormProvider>
    )
  }

  ReactDOM.createRoot(document.getElementById('root3')).render(<App />);

</script>
</body>
</html>